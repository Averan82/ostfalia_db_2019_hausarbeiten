# Kubernetes

Die Idee von Kubernetes ist die Entkopplung der Container von ihrer Serviceadresse, was durch eine Serviceschicht umgesetzt ist. Somit kann jede Serviceanfrage an einen Service gestellt und von mehreren Containern beantwortet werden. Jeder Service ist somit horizontal skalierbar. Kubernetes kümmert sich neben der Hochverfügbarkeit und des Routings von Services hauptsächlich um den Betrieb von Containern über einen längeren Zeitraum. Der automatisierte Neustart eines Pods ist dabei zentrales Instrument zur Skalierung.

## Infrastruktur

Aufgesetzt auf dem Betriebssystem läuft Kubernetes.
Der Administrator kommuniziert mit dem Kubernetes-Master, welcher die Tasks an die untergeordneten Nodes verteilt. Auf den Nodes laufen die Pods von Containern. Bei der Übergabe der Tasks von Master an Nodes, wird mit einer Vielzahl von Services gearbeitet, die automatisch entscheiden, welcher Node am besten für die Aufgabe geeignet ist. Der Node weist dann Ressourcen zu und legt die Pods in diesem Knoten fest, die die gewünschte Aufgabe durchführen sollen.


## Komponenten

Das Kubernetes-System besteht aus mehreren Bestandteilen, die in diesem Abschnitt näher erläutert werden sollen:

Kubernetes-Master
Der Kubernetes-Master ist für den Erhalt eines gewünschten Zustands eines Clusters verantwortlich. Er kontrolliert alle Kubernetes-Nodes und gibt die Task-Zuordnungen aus. Wenn man mit Kubernetes kommuniziert, spricht man immer mit dem Master.
Er besteht aus drei Prozessen, die auf einem einzelnen Node im Cluster ausgeführt werden, der als Master-Node bezeichnet wird. Diese Prozesse sind: kube-apiserver, kube-controller-manager und kube-scheduler.

Kubernetes-Node
Die Kubernetes-Nodes sind die Arbeitsmaschinen, auf denen die angeforderten und zugewiesenen Tasks und Cloud-Workflows ausgeführt werden. Nodes können je nach Cluster virtuelle oder physische Maschinen (Virtual Machines, physische Services usw.) sein. Nodes werden vom Kubernetes-Master kontrolliert.

Pods
Ein Pod ist eine Kubernetes-Abstraktion, die eine Gruppe von einem oder mehreren Anwendungscontainern und einigen gemeinsam genutzten Ressourcen für diese Container darstellt.
Diese Ressourcen bestehen aus:

- Gemeinsamer Speicher, als Volumes
- Networking, als eindeutige Cluster-IP-Adresse
- Informationen zur Ausführung der einzelnen Container, wie z.B. die Container-Image-Version oder bestimmte Ports, die verwendet werden sollen

Die Anzahl der Pods legt das Replica Set fest. Replica Set ist ein API-Objekt, welches die Skalierung von Pods managt. Dieser Service implementiert die Lastverteilung. Hinter der Service IP-Adresse verbergen sich die Pods. Somit gehen alle Requests an die gleiche IP-Adresse und werden auf alle Instanzen verteilt.

Pods werden von Kubernetes überwacht, um sie bei Bedarf neu zu starten oder ihnen Zeit zur Selbstheilung zu geben, falls die Pods ausgelastet sind. Ein Neustart wird durch die Liveness-Probe ausgelöst und die Selbstheilung durch die Readiness-Probe. Beide Probes können entweder HTTP-Endpunkte oder Container-Kommandos sein. Sie werden von Kubernetes nach Podstart und einer initialen Wartezeit in einem definierbaren Takt abgefragt. Im wiederholten Fehlerfall passiert folgendes:

Liveness-Fehlerfall: Kubernetes started den Pod neu.
Readiness-Fehlerfall: Kubernetes routet keinen weiteren Traffic zu diesem Pod.

https://jaxenter.de/der-steuermann-fuers-containerschiff-65844
https://www.redhat.com/de/topics/containers/what-is-kubernetes
https://cloud.google.com/kubernetes-engine/docs/concepts/pod?hl=de
https://www.admin-magazin.de/Das-Heft/2018/06/Kubernetes-Storage-mit-Rook
https://kubernetes.io/docs/concepts/containers/runtime-class/
https://www.innoq.com/de/articles/2019/05/kubernetes-einstieg/   12.01.2020

---

[<< Docker](2_docker.md) | [Inhaltsverzeichnis](README.md) | [Run Databases in Kubernetes >>](4_dbInK8s.md)

---

## TODO

- Wie müssen die Host-Maschinen konditioniert sein, damit Kubernetes da laufen kann?
- Grafik von Kubernetes mit den Komponenten und deren Zusammenspiel
- Wie stellt Kubernetes fest ob Container bzw. Pods laufen und ready sind? => Health und Readiness Checks, wenn Check fehlschlägt, dann Neustart
- Monitoring von Host-Ressourcen => Wie entscheidet Kubernetes wie und wann Lastverteilung stattfinden soll?
- Tabelle für Literaturverzeichnis einfügen und Links mit Titel und Aufrufdatum ergänzen
- Besonderheiten von Kubernetes und welche Vorteile
